{% extends "base.html" %}
{% load django_bootstrap5 %}
{% load static %}
{% load diary_filters %}  <!-- カスタムフィルタを読み込む -->

{% block title %}
    ほーむぺーじ
{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'diary/css/home.css' %}" type="text/css" >
{% endblock extra_css %}

{% block content %}
    <div class="container-home">
        <div class="diaryinformation-field mb-4 mx-auto col-lg-9 col-12">
            <div class="card">
                <div class="card-header">
                    <h5>
                        <strong>作成した日記の数</strong>
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="field-label">
                                総合計
                            </div>
                            <div class="field-value">{{ diary_count }} コ</div>
                        </div>
                        <div class="col-6">
                            <div class="field-label">
                                当日作成
                            </div>
                            <div class="field-value">{{ diary_count_ontheday }} コ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="diary-list-field my-3">
            <ul class="nav nav-tabs nav-fill d-flex flex-nowrap" role="tablist">
                <li class="nav-item flex-shrink-0" role="presentation">
                    <button class="nav-link active" type="button" data-bs-toggle="tab" data-bs-target="#tab_diary-myself-field">
                        {{user.username}}さんの日記
                    </button>
                </li>
                <li class="nav-item flex-shrink-0" role="presentation">
                    <button class="nav-link" type="button" data-bs-toggle="tab" data-bs-target="#tab_diary-public-field">
                        みんなの日記
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="tab_diary-myself-field">
                    <div class="diary-myself-field mt-5">
                        <div class="diary-list row">
                            {% for data in diaries_mine %}
                                <div class="card-container col-12 col-md-6 col-lg-4 my-2">
                                    {% for loc in data.diary.locations.all %}
                                        {% if loc.is_thumbnail %}
                                            <div class="card card-rank{{ data.diary.rank }}">
                                                <div class="card-thumbnail">
                                                    <img src="{{ loc.image.url }}" alt="サムネイル" class="thumbnail-img" style="transform: rotate({{ loc.rotate_angle }}deg);" onclick="zoom_image('{{ loc.image.url }}','{{ loc.rotate_angle }}')">  <!-- 画像を表示 -->
                                                    <a class="to-calendar-button" href="{% url 'diary:calendar' %}?diary_date={{ data.diary.date|date:"Y-m-d" }}"></a>
                                                </div>
                                                <div class="card-body row">
                                                    <div class="card-diaryinfo col-9">
                                                        <div class="row">
                                                            <div class="card-locations">
                                                                {{ loc.label }}
                                                            </div>
                                                            <div class="card-date">
                                                                <div class="card-explanation">
                                                                    {{ data.diary.date|days_ago }}  <!-- 日付を「何日前」形式で表示 -->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-good col-3 d-flex justify-content-center align-items-center">
                                                        <i class="icon-goodcount"></i>
                                                        <span class="good-count">{{ data.good_count }}</span>
                                                    </div>                                                    
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            {% empty %}
                            <div class="row justify-content-center text-center">
                                <img src="{% static 'diary/img/sabori_man.png' %}" class="col-4" alt="サボり人">
                                <p>まだ日記が登録されていません</p>
                                <a href="{% url 'diary:diary_photo' %}">日記作成はここから</a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="tab_diary-public-field">
                    <div class="diary-public-field mt-5">
                        <div class="diary-list row">
                            {% for diary in diaries_public %}
                                <div class="card-container col-12 col-md-6 col-lg-4 my-2">
                                    <div class="card">
                                        <div class="card-thumbnail">
                                            <img src="{{ diary.image }}" alt="サムネイル" class="thumbnail-img" style="transform: rotate({{ diary.rotate_angle }}deg);" onclick="zoom_image('{{ diary.image }}','{{ diary.rotate_angle }}')">  <!-- 画像を表示 -->
                                        </div>
                                        <div class="card-body row">
                                            <div class="card-userinfo col-9">
                                                <div class="row">
                                                    <div class="card-user">
                                                        <img src="{{ diary.user.icon_url}}" class="rounded-circle bg-white border" width="30" height="30" alt="icon" loading="lazy">
                                                        <span class="card-explanation px-2">{{ diary.user.username }}</span>
                                                    </div>
                                                    <div class="card-date">
                                                        <div class="card-explanation">
                                                            {{ diary.date|days_ago }}  <!-- 日付を「何日前」形式で表示 -->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card-good col-3 d-flex justify-content-center align-items-center">
                                                <button class="toggle-diary-good icon-in-button" type="button" data-url="{% url 'diary:good_for_diary' pk=diary.diary_id %}">
                                                    <i class="icon-liked" data-liked="{{ diary.liked|lower }}"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% empty %}
                            <div class="row justify-content-center text-center">
                                <img src="{% static 'diary/img/sabori_man.png' %}" class="col-4" alt="サボり人">
                                <p>今日は誰も日記を書いていないようです</p>
                                <p>あなたが最初のユーザーになるチャンス！</p>
                                <a href="{% url 'diary:diary_photo' %}">日記作成はここから</a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="imageModalContainer" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                    <div class="pseudo-modal-header ms-auto">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <img id="modalImage" src="" alt="サムネイル拡大表示" class="zoom_image">  <!-- モーダルで表示する画像 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block extra_js %}
    <script src="{% static 'js/loading_overlay.js' %}"></script>
    <script src="{% static 'diary/js/adjust_imgs.js' %}"></script>
    <script src="{% static 'diary/js/home.js' %}"></script>
{% endblock %}